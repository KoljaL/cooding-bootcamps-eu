<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="img/favicon-dark.png" rel="icon" />
  <title>LinkedIn Contacts</title>

  <script>
    document.documentElement.setAttribute('data-theme', window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light')
  </script>
  <link rel="stylesheet" href="./css/almostclassless.css">
  <link rel="stylesheet" href="./css/layout.css">

  <style>
    html,
    header,
    body,
    footer {
      background-color: var(--secondary-bg1);
    }

    .pendingInvitations {
      padding: 1rem;
      margin: 0;
      margin-bottom: 1rem;
      background-color: var(--secondary-bg);
      border: 1px solid var(--primary-lighter);
      border-radius: 0.5rem;
    }

    .pendingInvitations__header {
      display: flex;
      align-items: center;
    }

    .pendingInvitation {

      margin: 0;
      font-size: 1.3rem;
      line-height: 1;
      color: var(--secondary);
    }

    .pendingInvitations__manage {
      margin: 0;
      font-size: 1.1rem !important;
      color: var(--primary);
      font-weight: 700;
      text-decoration: none;
      transition: all 0.2s ease-in-out;
    }

    .pendingList {
      display: flex;
      grid-gap: 1rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }

    .pendingList:empty {
      display: none;
    }

    .contacts {
      background-color: var(--secondary-bg);
      border: 1px solid var(--primary-lighter);
      border-radius: 0.5rem;
      padding: 1rem;
    }

    .contacts__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: .5rem .25rem 1rem .25rem;
    }

    .contacts__title {
      margin: 0;
      font-size: 1.3rem;
      color: var(--secondary);
    }

    .contacts__seeAll {
      margin: 0;
      font-size: 1.1rem !important;
      color: var(--primary);
      font-weight: 700;
      text-decoration: none;
      transition: all 0.2s ease-in-out;
    }

    .contactList {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      grid-gap: 1rem;
    }

    .contactCard {
      background-color: var(--color-bg);
      border: 1px solid var(--primary-lighter);
      border-radius: 0.5rem;
      box-shadow: 0 0 0.5rem 0.5rem var(--color-bg);
      overflow: hidden;
      position: relative;
      opacity: 1;
      transition: opacity 600ms;
    }

    .contactCard__bg_img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 70px;
      object-fit: cover;
      z-index: 0;
      border: 0;
    }

    .contactCard__remove {
      position: absolute;
      top: .5rem;
      right: .5rem;
      width: 2rem;
      height: 2rem;
      background-color: hsla(0, 0%, 0%, 0.6);
      color: var(--secondary-dark);
      padding: 0;
      min-height: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
    }



    .contactCard__remove:hover {
      background-color: hsla(0, 0%, 0%, 0.9) !important;
      color: var(--secondary);
    }

    [data-theme="light"] .contactCard__remove {
      background-color: hsla(0, 0%, 0%, 0.3);
      color: var(--secondary-bg1);
    }

    [data-theme="light"] .contactCard__remove:hover {
      background-color: hsla(0, 0%, 0%, 0.5);
      color: var(--secondary-bg1);
    }

    .contactCard__remove svg {
      width: 1.5rem;
      height: 1.5rem;
    }

    .contactCard__content {
      padding: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .contactCard__img {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      z-index: 1;
    }

    .contactCard__name {
      margin: 0;
      margin-top: .5rem;
      font-size: 1.1rem;
      color: var(--secondary);
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
      width: 100%;
      text-align: center;
    }

    .contactCard__title {
      margin: 0;
      font-size: 0.9rem;
      line-height: 1;
      color: var(--secondary-dark);
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
      width: 100%;
      text-align: center;
    }

    .contactCard__connections {
      color: var(--secondary-dark);
      margin: 1rem 0;
    }

    .contactCard__connections_icon {
      display: inline-block;
      width: 1rem;
      height: 1rem;
      margin: 0;
      fill: red;
      font-size: 0.8rem;
      font-weight: 400;
      text-align: center;
    }

    .contactCard__connections_count {
      display: inline-block;
      margin: 0;
      font-size: 0.8rem;
      font-weight: 400;
      text-align: center;
    }

    .contactCard__connect_button {
      margin: 0;
      width: 100%;
      font-size: 1rem;
      color: var(--primary);
      font-weight: 700;
      background-color: transparent;
      border: 1px solid var(--primary);
      border-radius: 25px;
      min-height: 2.2rem;
      transition: all 0.2s ease-in-out;
    }

    .contactCard__connect_button:hover {
      color: var(--secondary-bg) !important;
      background-color: var(--primary) !important;
      border: 1px solid var(--primary-light) !important;
    }



    .hide {
      opacity: 0;
    }
  </style>
</head>


<body>
  <header>
    <h1>LinkedIn Contacts</h1>
    <span class="icons">
      <label class="theme-toggle" title="Toggle theme"></label>
    </span>
  </header>
  <div class="spacer"></div>

  <div class="pendingInvitations">
    <div class="pendingInvitations__header">
      <div class="pendingInvitation">No pending Invitiations</div>
      <a href="#" title="See all people you may know" class="pendingInvitations__manage">&nbsp;</a>
    </div>

    <div class="pendingList"></div>

  </div>


  <div class="contacts">
    <div class="contacts__header">
      <h2 class="contacts__title">People you may know</h2>
      <a href="#" title="See all people you may know" class="contacts__seeAll">See all</a>
    </div>
    <div class="contactList"></div>
  </div>



  <div class="spacer"></div>
  <footer>
    <p>
      <a target="_blank" class="sourceCode" href="https://github.com/KoljaL/cooding-bootcamps-eu/tree/master/docs">Repo on GitHub</a>
    </p>
  </footer>

  <template id="contactCard">
    <div class="contactCard hide">
      <img class="contactCard__bg_img" src="" alt="">
      <button class="contactCard__remove">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
          <g transform="rotate(90 8 8)">
            <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m11.25 4.75l-6.5 6.5m0-6.5l6.5 6.5" />
          </g>
        </svg>
      </button>
      <div class="contactCard__content">
        <img class="contactCard__img" src="" alt="">
        <h3 class="contactCard__name"></h3>
        <p class="contactCard__title"></p>
        <div class="contactCard__connections">
          <span class="contactCard__connections_icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 200">
              <g transform="rotate(45 128 128)">
                <path fill="currentColor" d="m212.9 122.3l-30.3 30.3a56 56 0 0 1-79.2 0a12 12 0 1 1 16.9-16.9a32.2 32.2 0 0 0 45.3 0l30.3-30.3a32 32 0 0 0-45.3-45.3l-9.6 9.7a12 12 0 0 1-17-17l9.7-9.7a56 56 0 1 1 79.2 79.2ZM115 186.2l-9.6 9.7a32 32 0 0 1-45.3-45.3l30.3-30.3a32.2 32.2 0 0 1 45.3 0a12 12 0 0 0 16.9-16.9a55.9 55.9 0 0 0-79.2 0l-30.3 30.3a56 56 0 0 0 79.2 79.2l9.7-9.7a12 12 0 0 0-17-17Z" />
              </g>
            </svg>
          </span>
          <span class="contactCard__connections_count"></span>
        </div>
        <button class="contactCard__connect_button">Connect</button>
      </div>
    </div>
  </template>

  <script>
    const contactCard = document.querySelector('#contactCard').content;
    const contactList = document.querySelector('.contactList');
    const seeAll = document.querySelector('.contacts__seeAll');
    const manageInvitationsButton = document.querySelector('.pendingInvitations__manage');
    const pendingButton = document.querySelector('.pendingInvitations__manage');
    const pendingInvitation = document.querySelector('.pendingInvitation');
    const pendingList = document.querySelector('.pendingList');
    let pendingInvitationsCount = 0;

    fetchContacts(8);


    seeAll.addEventListener('click', () => {
      fetchContacts(20);
    });


    function fetchContacts(count) {
      return fetch('https://dummy-apis.netlify.app/api/contact-suggestions?count=' + count)
        .then(response => response.json())
        .then(contacts => renderContacts(contacts))
        .catch(error => console.error(error));
    }



    function createContactCard(contact) {

      let mutualConnectionsText = 'no mutual connection';
      if (contact.mutualConnections === 1) {
        mutualConnectionsText = '1 mutual connection';
      } else {
        mutualConnectionsText = contact.mutualConnections + ' mutual connections';
      }

      const clone = contactCard.cloneNode(true);
      clone.querySelector('.contactCard__img').src = contact.picture;
      clone.querySelector('.contactCard__bg_img').src = contact.backgroundImage;
      clone.querySelector('.contactCard__name').textContent = contact.name.title + ' ' + contact.name.first + ' ' + contact.name.last;
      clone.querySelector('.contactCard__title').textContent = contact.title;
      clone.querySelector('.contactCard__remove').addEventListener('click', removeContactCard);
      clone.querySelector('.contactCard__connections_count').textContent = mutualConnectionsText;
      clone.querySelector('.contactCard__connect_button').addEventListener('click', managePendingInvitations);
      return clone;
    }

    function managePendingInvitations() {
      pendingInvitationsCount++;
      let s = (pendingInvitationsCount > 1) ? 's' : '';
      pendingInvitation.textContent = pendingInvitationsCount + ' pending Invitiation' + s;
      this.textContent = 'Pending';

      let thiscard = this.closest('.contactCard');
      let clone = thiscard.cloneNode(true);
      let width = getComputedStyle(thiscard).width;
      console.log(width);
      clone.querySelector('.contactCard__connect_button').addEventListener('click', stopPendingInvitation);

      clone.style.width = width;
      clone.querySelector('.contactCard__remove').remove();
      clone.classList.add('hide');
      setTimeout(() => {
        clone.classList.remove('hide');
      }, 10);
      pendingList.appendChild(clone);
      this.closest('.contactCard').remove();

      fetchContacts(1);
    }

    function stopPendingInvitation() {
      pendingInvitationsCount--;
      let s = (pendingInvitationsCount > 1) ? 's' : '';
      pendingInvitation.textContent = pendingInvitationsCount + ' pending Invitiation' + s;

      this.textContent = 'Connect';

      let thiscard = this.closest('.contactCard');
      let clone = thiscard.cloneNode(true);

      clone.querySelector('.contactCard__connect_button').addEventListener('click', managePendingInvitations);

      clone.style.width = '';
      let removeButton = document.createElement('button');
      removeButton.classList.add('contactCard__remove');
      removeButton.textContent = 'Remove';
      removeButton.addEventListener('click', removeContactCard);
      clone.appendChild(removeButton);
      // clone.querySelector('.contactCard__remove').remove();
      clone.classList.add('hide');
      setTimeout(() => {
        clone.classList.remove('hide');
      }, 10);
      contactList.appendChild(clone);
      this.closest('.contactCard').remove();
    }

    function renderContacts(contacts) {
      for (const contact of contacts) {
        if (contact.backgroundImage === '') {
          contact.backgroundImage = './img/bg-image.jpg';
        }
        contactList.appendChild(createContactCard(contact));
        // get last child and remove class hide
        const lastChild = contactList.lastElementChild;
        setTimeout(() => {
          lastChild.classList.remove('hide');
        }, 10);
      };
    }




    function removeContactCard() {
      this.closest('.contactCard').remove();
      fetchContacts(1);
    }



  </script>
  <script src="./js/menu.js"></script>
  <script src="./js/toggleTheme.js"></script>

</body>

</html>